{% extends "base.html" %}

{% block title %}
Search
{% endblock %}

{% block body %}
<script src="https://d3js.org/d3.v4.min.js"></script>

<div style="width: 100%;">
  <div class="text-center" id="dex" style="width: 50%;  float: left;">
    <!-- <h1>Searches for: {{ search }}</h1> -->
    <br>
    <h2 id="name"></h2>
    <br>
    <h2 id="id"></h2>
    <img id="image" width='200' height='200'></img>
    <br>
    <h5 id="list"></h5>
  </div>
  <br>
  <div id="stats" style="margin-left: 10%;">
    <br><br><br>
    <h5 id="weight"></h5>
    <h5 id="height"></h5>
  </div>
</div>
<br><br>
<style>
  
  .badge-normal {
      background-color: #838683;
      color: white;
  }
  .badge-fighting {
      background-color: #be4a33;
      color: white;
  }
  .badge-flying {
      background-color: #89c0e8;
      color: white;
  }
  .badge-poison {
      background-color: #c43cf3 ;
      color: white;
  }
  .badge-ground {
      background-color: #6d3803 ;
      color: white;
  }
  .badge-rock {
      background-color: #c4b287 ;
      color: white;
  }
  .badge-bug {
      background-color: #bcf75a ;
      color: white;
  }
  .badge-ghost {
      background-color: #6814fc;
      color: white;
  }
  .badge-steel {
      background-color: #6b7cb4;
      color: white;
  }
  .badge-fire {
      background-color: #ffab03;
      color: white;
  }
  .badge-water {
      background-color: #4c95ff;
      color: white;
  }
  .badge-grass {
      background-color: #0dd000;
      color: white;
  }
  .badge-electric {
      background-color: #fff813;
      color: white;
  }
  .badge-psychic {
      background-color: #a83674;
      color: white;
  }
  .badge-ice {
      background-color: #9ff5f7;
      color: white;
  }
  .badge-dragon {
      background-color: #0726d6;
      color: white;
  }
  .badge-fairy {
      background-color: #ffc2d0;
      color: white;
  }
  .badge-dark {
      background-color: #01030e;
      color: white;
  }
  
			    
</style>

<script>
  
  var pokemon = {{ result | safe }}
  var mons = document.getElementById("dex");
  var n = document.getElementById('name');
  cn = pokemon[0].charAt(0).toUpperCase() + pokemon[0].slice(1);
  n.innerHTML = cn;
  
  var d = document.getElementById('id');
  console.log(pokemon[1] < 10)
  if (pokemon[1] < 10) { d.innerHTML = "#00" + pokemon[1]; }
  else if (pokemon[1] > 10 && pokemon[1] < 100) { d.innerHTML = "#0" + pokemon[1]; }
  else { d.innerHTML = "#" + pokemon[1]; }
  
  var i = document.getElementById('image');
  i.setAttribute('src',pokemon[2]);

  var get_type = function(type) {
      if (type === "normal") return "badge-normal";
      else if (type === "fighting") return "badge-fighting";
      else if (type === "flying") return "badge-flying";
      else if (type === "poison") return "badge-poison";
      else if (type === "ground") return "badge-ground";
      else if (type === "rock") return "badge-rock";
      else if (type === "bug") return "badge-bug";
      else if (type === "ghost") return "badge-ghost";
      else if (type === "steel") return "badge-steel";
      else if (type === "fire") return "badge-fire";
      else if (type === "water") return "badge-water";
      else if (type === "grass") return "badge-grass";
      else if (type === "electric") return "badge-electric";
      else if (type === "psychic") return "badge-psychic";
      else if (type === "ice") return "badge-ice";
      else if (type === "dragon") return "badge-dragon";
      else if (type === "fairy") return "badge-fairy";
      else if (type === "dark") return "badge-dark";
  }

  var t = pokemon[3];
  types = t.split(' ');
  l = t.split(' ').length-1;
  for (i = 0; i < l; i++) {
      var h = document.createElement("H3");
      var badge = document.createElement("SPAN");
      badge.setAttribute("class","badge badge-pill " + get_type(types[i]));
      badge.innerHTML = types[i];
      h.appendChild(badge)
      mons.appendChild(h);
  };

  var stats = pokemon[6].split(' ');
  stats.pop()
  for (i = 0; i < 6; i++) {
      stats[i] = parseInt(stats[i]);
  };
  var lis = document.getElementById("list");
  lis.innerHTML = "HP: " + stats[0] + "\t   Attack: " + stats[1] + "   Defense: " + stats[2] + "   Special Attack: " + stats[3] + "   Special Defense: " + stats[4] + "   Speed: " + stats[5]
  // FIX THIS ^^^ AJFDKAJ
  
  var w = document.getElementById("weight");
  w.innerHTML = "Weight: " + pokemon[4] + " hectograms";
  var h = document.getElementById("height");
  h.innerHTML = "Height: " + pokemon[5] + " decimeters";

  let data = [];
  let features = ['HP', 'Attack', 'Defense', 'Special Attack', 'Special Defense','Speed']
  //generate the data
  var point = {}
  point[features[0]] = stats[0];
  point[features[1]] = stats[1];
  point[features[2]] = stats[2];
  point[features[3]] = stats[3];
  point[features[4]] = stats[4];
  point[features[5]] = stats[5];
  data.push(point);
  console.log(data);
  let svg = d3.select("body").append("svg")
      .attr("width", 400)
      .attr("height", 400);
  
  let radialScale = d3.scaleLinear()
      .domain([0,255])
      .range([0,180]);
  let ticks = [50,100,150,200,250];
  
  ticks.forEach(t =>
		svg.append("circle")
		.attr("cx", 200)
		.attr("cy", 200)
		.attr("fill", "none")
		.attr("stroke", "gray")
		.attr("r", radialScale(t))
	       );
  ticks.forEach(t =>
		svg.append("text")
		.attr("x", 210)
		.attr("y", 200 - radialScale(t))
		.text(t.toString())
	       );
  function angleToCoordinate(angle, value){
      let x = Math.cos(angle) * radialScale(value);
      let y = Math.sin(angle) * radialScale(value);
      return {"x": 200 + x, "y": 200 - y};
  }

  for (var i = 0; i < features.length; i++) {
      let ft_name = features[i];
      let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
      let line_coordinate = angleToCoordinate(angle, 255);  // fix position of labels
      let label_coordinate = angleToCoordinate(angle, 260);

      //draw axis line
      svg.append("line")
	  .attr("x1", 200)
	  .attr("y1", 200)
	  .attr("x2", line_coordinate.x)
	  .attr("y2", line_coordinate.y)
	  .attr("stroke","black");

      //draw axis label
      svg.append("text")
	  .attr("x", label_coordinate.x)
	  .attr("y", label_coordinate.y)
	  .text(ft_name);
  }

  let line = d3.line()
      .x(d => d.x)
      .y(d => d.y);
  // add some more colors
  let colors = ["darkorange", "gray", "navy", "steelblue", "pink", "orangered"];

  function getPathCoordinates(data_point){
      let coordinates = [];
      for (var i = 0; i < features.length; i++){
          let ft_name = features[i];
          let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
          coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
      }
      return coordinates;
  }

  for (var i = 0; i < data.length; i ++){
      let d = data[i];
      let color = colors[Math.floor(Math.random() * 6)];
      let coordinates = getPathCoordinates(d);

      //draw the path element
      svg.append("path")
	  .datum(coordinates)
	  .attr("d",line)
	  .attr("stroke-width", 3)
	  .attr("stroke", color)
	  .attr("fill", color)
	  .attr("stroke-opacity", 1)
	  .attr("opacity", 0.5);
  }


</script>



{% endblock %}
